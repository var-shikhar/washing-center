import{u as P,b as z,r as a,R as I,j as e,d as G,B as T}from"./index-CqTeLtxb.js";import{C as R}from"./customTooltip-Cm5B4Nta.js";import{T as O,U as $}from"./user-nav-CuJ6PXpK.js";import{D as F,a as M,b as _,c as q,d as H}from"./dialog-Dw6tzNGH.js";import{I as V}from"./input-kuuneSwt.js";import{S as X,a as U,b as Q,c as B,e as E}from"./select-DH3ggwBd.js";import{S as K}from"./separator-BUfGuCKw.js";import{L as k}from"./dropdown-menu-DKbT86Q3.js";import{u as Z,z as L,t as J}from"./index-zB_YfoIT.js";import{I as W,a as Y}from"./IconTrash-CpCoMDb6.js";import{c as ee,d as te,I as se,a as ne,b as ae}from"./IconSortDescendingLetters-CsoR9-Sq.js";import{I as oe}from"./IconListDetails-CiOK5lBz.js";import"./tooltip-yzDxOwDD.js";import"./index-Bu26ftxf.js";import"./index-BCIuvM3R.js";import"./index-B13qeSKT.js";import"./commonFn-tXP-utln.js";import"./index-CNCQmZcA.js";import"./index-B-aHNU69.js";import"./index-CbVhG4qA.js";import"./index-CbZN7qqK.js";const re=()=>{const{HandleGetRequest:n,HandlePostRequest:x}=P(),{handleCenterSelection:C}=z(),[b,g]=a.useState(!0),[r,p]=a.useState(!1),[l,h]=a.useState({title:"",id:""}),[N,m]=a.useState("ascending"),[f,i]=a.useState(""),[s,t]=a.useState([]),[c,w]=a.useState([]);a.useEffect(()=>{b&&j(I.commonCenterRoute)},[b]),a.useEffect(()=>{if((s==null?void 0:s.length)>0){let o=s.sort((u,D)=>{var A;return N==="ascending"?(A=u.centerName)==null?void 0:A.localeCompare(D.centerName):D.centerName.localeCompare(u.centerName)});f!==""&&(o=o.filter(u=>u.centerName.toLowerCase().includes(f.toLowerCase()))),a.startTransition(()=>{w(o)})}},[N,f,s]);async function j(o){const u=await n({route:o});(u==null?void 0:u.status)===200&&a.startTransition(()=>{t(u.data),g(!1)})}async function y(o,u){const D=await x({route:`${I.commonCenterRoute}/${o}`,data:{centerID:o,value:u},toastDescription:`Center has ${u?"activated":"de-activated"} successfully`,type:"put"});(D==null?void 0:D.status)===200&&d()}async function v(o){const u=await x({route:`${I.commonCenterRoute}/${o}`,data:{centerID:o},toastDescription:"Center has deleted successfully",type:"delete"});(u==null?void 0:u.status)===200&&d()}async function S(o){C(o,!0)}function d(){a.startTransition(()=>{g(!0)})}return{modalToggle:r,setModalToggle:p,selectedSort:N,setSelectedSort:m,searchTerm:f,setSearchTerm:i,modalData:l,setModalData:h,filteredList:c,handleConfirmation:d,handleCenterStatusUpdate:y,handleCenterDeletion:v,handleCenterSelectionFunction:S}},le=({locationDetail:n,setLocationDetail:x,showAddress:C,mapClass:b})=>{var f,i;const g=a.useRef(null),r=a.useRef(null),p=a.useRef(null),[l,h]=a.useState({address:n.address??"",geoLocation:{lat:n.geoLocation.lat!==0?n.geoLocation.lat:28.613459424004443,long:n.geoLocation.long!==0?n.geoLocation.long:77.2119140625}});a.useEffect(()=>{console.log(n),console.log(l)},[]),a.useEffect(()=>{(()=>{var t;if((t=window.google)!=null&&t.maps)N();else{const c=document.createElement("script");c.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3_PRUxLRb7tkxX1dhHZHRFDDQ7_R8E_Q&libraries=places",c.async=!0,c.onload=N,document.body.appendChild(c)}})()},[]);const N=()=>{if(r.current){const s={lat:l.geoLocation.lat,lng:l.geoLocation.long},t=new window.google.maps.Map(r.current,{center:s,zoom:5});p.current=new window.google.maps.Marker({position:s,map:t,draggable:!0}),l.geoLocation.lat!==0&&l.geoLocation.long!==0&&m(l.geoLocation.lat,l.geoLocation.long),p.current.addListener("dragend",()=>{var v,S,d,o;const j=(S=(v=p.current)==null?void 0:v.getPosition())==null?void 0:S.lat(),y=(o=(d=p.current)==null?void 0:d.getPosition())==null?void 0:o.lng();j&&y&&m(j,y)});const c=new window.google.maps.Geocoder,w=()=>{var j;(j=g.current)!=null&&j.value&&c.geocode({address:g.current.value},(y,v)=>{var S;if(v===window.google.maps.GeocoderStatus.OK&&y){const d=y[0];if(d.geometry){const o=d.geometry.location;t.setCenter(o),t.setZoom(15),(S=p.current)==null||S.setPosition(o),m(o.lat(),o.lng())}}else console.error("Geocoding failed:",v)})};g.current&&g.current.addEventListener("change",w)}},m=(s,t)=>{new window.google.maps.Geocoder().geocode({location:{lat:s,lng:t}},(w,j)=>{if(j===window.google.maps.GeocoderStatus.OK&&w){const y=w[0].formatted_address;let v="",S="";w[0].address_components.forEach(d=>{const o=d.types;o.includes("locality")&&(v=d.long_name),o.includes("administrative_area_level_1")&&(S=d.long_name)}),a.startTransition(()=>{x(d=>({...d,address:y,geoLocation:{lat:s,long:t},city:v,state:S})),h(d=>({...d,address:y}))})}else console.error("Geocoding failed:",j)})};return e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:g,type:"text",placeholder:"Enter a location",className:"border rounded px-3 py-2 w-full my-2 focus:outline-none focus:ring",value:l.address,onChange:s=>h(t=>({...t,address:s.target.value}))}),e.jsx("div",{ref:r,className:`h-[400px] w-full rounded-lg ${b}`}),C&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Selected Address:"}),e.jsx("p",{className:"text-gray-800",children:n.address}),"Latitude: ",e.jsx("span",{className:"font-normal text-gray-800",children:(f=n.geoLocation)==null?void 0:f.lat})," Longitude: ",e.jsx("span",{className:"font-normal text-gray-800",children:(i=n.geoLocation)==null?void 0:i.long})]})]})},ie=(n="")=>{const{HandleGetRequest:x,HandlePostRequest:C}=P(),[b,g]=a.useState(n!==""),[r,p]=a.useState(0),[l,h]=a.useState({id:n,address:"",city:"",state:"",geoLocation:{lat:0,long:0},centerName:"",centerEmail:"",centerPhone:"",centerDOI:"",timing:{open:"",close:""}}),N=i=>{h(s=>({...s,...typeof i=="function"?i(s):i}))};a.useEffect(()=>{b&&m(`${I.commonCenterRoute}/${n}`)},[b,n]);async function m(i){const s=await x({route:i});(s==null?void 0:s.status)===200&&a.startTransition(()=>{h(t=>({...t,...s.data})),g(!1)})}async function f(i,s){const t={...i,address:l.address,city:l.city,state:l.state,geoLocation:l.geoLocation},c=await C({data:t,route:I.commonCenterRoute,type:n===""?"post":"put",toastDescription:`Center has ${n===""?"created":"updated"} successfully!`});(c==null?void 0:c.status)===200&&s()}return{defaultValues:l,currentPhase:r,loading:b,setCurrentPhase:p,setDefaultValues:h,setLocationDetail:N,handleFormSubmission:f}},ce=L.object({id:L.string().optional(),centerName:L.string().min(2,{message:"Name should have at least 2 characters"}),centerEmail:L.string().email({message:"Invalid email format"}),centerPhone:L.string().min(10,{message:"Phone number must be 10 digits"}).max(10,{message:"Phone number must be 10 digits"}),centerDOI:L.string().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"Invalid date format"}),timing:L.object({open:L.string().nonempty({message:"Opening time is required"}),close:L.string().nonempty({message:"Closing time is required"})}).refine(n=>{const x=new Date(`1970-01-01T${n.open}:00`);return new Date(`1970-01-01T${n.close}:00`)>x},{message:"Closing time must be later than opening time",path:["close"]})});function de({className:n,formID:x,handleConfirmation:C,...b}){var w,j;const{currentPhase:g,defaultValues:r,loading:p,setCurrentPhase:l,setLocationDetail:h,handleFormSubmission:N}=ie(x),{register:m,handleSubmit:f,reset:i,formState:{errors:s,isValid:t}}=Z({resolver:J(ce),defaultValues:r,mode:"onChange"});a.useEffect(()=>{r&&i(r)},[r,i]);async function c(y){N(y,C)}return e.jsx("div",{className:G("grid gap-6",n),...b,children:g===0?e.jsxs("div",{children:[!p&&e.jsx(le,{locationDetail:r,setLocationDetail:h,showAddress:!0,mapClass:"h-[300px]"}),e.jsx(T,{className:"mt-2 w-full",type:"button",disabled:r.address===""||r.geoLocation.lat===0||r.geoLocation.long===0,onClick:()=>l(1),children:"Next"})]}):e.jsxs("form",{onSubmit:f(c),className:"p-6 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-center",children:"Center Information"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mt-1 py-2 rounded-md w-full",children:"Center Name"}),e.jsx("input",{type:"text",...m("centerName"),placeholder:"John Doe",className:"mt-1 p-2 border border-gray-300 rounded-md focus:border-transparent focus:ring-2 focus:ring-black focus:outline-none w-full"}),s.centerName&&e.jsx("p",{className:"text-red-600 text-sm",children:s.centerName.message})]}),e.jsxs("div",{className:"mb-4 flex flex-col lg:flex-row lg:space-x-4",children:[e.jsxs("div",{className:"flex-1 mb-4 lg:mb-0",children:[e.jsx("label",{className:"mt-1 py-2 rounded-md w-full",children:"Center Email"}),e.jsx("input",{type:"email",...m("centerEmail"),placeholder:"john@example.com",className:"mt-1 p-2 border border-gray-300 rounded-md focus:border-transparent focus:ring-2 focus:ring-black focus:outline-none w-full"}),s.centerEmail&&e.jsx("p",{className:"text-red-600 text-sm",children:s.centerEmail.message})]}),e.jsxs("div",{className:"flex-1 mb-4 lg:mb-0",children:[e.jsx("label",{className:"mt-1 py-2 rounded-md w-full",children:"Center Phone"}),e.jsx("input",{type:"text",...m("centerPhone"),placeholder:"9898XXXXXX",className:"mt-1 p-2 border border-gray-300 rounded-md focus:border-transparent focus:ring-2 focus:ring-black focus:outline-none w-full"}),s.centerPhone&&e.jsx("p",{className:"text-red-600 text-sm",children:s.centerPhone.message})]})]}),e.jsxs("div",{className:"mb-4 flex flex-col lg:flex-row lg:space-x-4",children:[e.jsxs("div",{className:"flex-1 mb-4 lg:mb-0",children:[e.jsx("label",{className:"mt-1 py-2 rounded-md w-full",children:"Date of Incorporation"}),e.jsx("input",{type:"date",...m("centerDOI"),className:"mt-1 p-2 border border-gray-300 rounded-md focus:border-transparent focus:ring-2 focus:ring-black focus:outline-none w-full"}),s.centerDOI&&e.jsx("p",{className:"text-red-600 text-sm",children:s.centerDOI.message})]}),e.jsxs("div",{className:"flex-1 mb-4 lg:mb-0",children:[e.jsx("label",{className:"mt-1 py-2 rounded-md w-full",children:"Center Opening Time"}),e.jsx("input",{type:"time",...m("timing.open"),className:"mt-1 p-2 border border-gray-300 rounded-md focus:border-transparent focus:ring-2 focus:ring-black focus:outline-none w-full"}),((w=s.timing)==null?void 0:w.open)&&e.jsx("p",{className:"text-red-600 text-sm",children:s.timing.open.message})]}),e.jsxs("div",{className:"flex-1 mb-4 lg:mb-0",children:[e.jsx("label",{className:"mt-1 py-2 rounded-md w-full",children:"Center Closing Time"}),e.jsx("input",{type:"time",...m("timing.close"),className:"mt-1 p-2 border border-gray-300 rounded-md focus:border-transparent focus:ring-2 focus:ring-black focus:outline-none w-full"}),((j=s.timing)==null?void 0:j.close)&&e.jsx("p",{className:"text-red-600 text-sm",children:s.timing.close.message})]})]}),e.jsx(T,{className:"mt-2 w-full",type:"submit",disabled:!t,children:x===""?"Create New Center":"Update Center Details"})]})})}function Ae(){const{filteredList:n,handleConfirmation:x,modalToggle:C,searchTerm:b,selectedSort:g,setModalToggle:r,setSearchTerm:p,setSelectedSort:l,modalData:h,setModalData:N,handleCenterDeletion:m,handleCenterStatusUpdate:f,handleCenterSelectionFunction:i}=re();function s(t,c){r(!0),N({id:t,title:c})}return e.jsxs(k,{fixed:!0,children:[e.jsx(k.Header,{children:e.jsxs("div",{className:"flex w-full items-center justify-end space-x-4",children:[e.jsx(O,{}),e.jsx($,{})]})}),e.jsxs(k.Body,{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Center List"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage your center at one place."})]}),e.jsxs("div",{className:"my-4 flex items-end justify-between sm:my-0 sm:items-center",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:my-4 sm:flex-row",children:[e.jsx(V,{placeholder:"Filter centers...",className:"h-9 w-40 lg:w-[250px]",value:b,onChange:t=>p(t.target.value)}),e.jsxs(X,{value:g,onValueChange:l,children:[e.jsx(U,{className:"w-16",children:e.jsx(Q,{children:e.jsx(W,{size:18})})}),e.jsxs(B,{align:"end",children:[e.jsx(E,{value:"ascending",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ee,{size:16}),e.jsx("span",{children:"Ascending"})]})}),e.jsx(E,{value:"descending",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(te,{size:16}),e.jsx("span",{children:"Descending"})]})})]})]})]}),e.jsxs(F,{open:C,onOpenChange:r,children:[e.jsx(M,{asChild:!0,children:e.jsx(T,{type:"button",onClick:()=>s("","Add New Center"),children:"Add New Center"})}),e.jsxs(_,{className:"sm:max-w-[50vw]",children:[e.jsx(q,{children:e.jsx(H,{children:h.title})}),e.jsx(de,{formID:h.id,handleConfirmation:()=>{x(),r(!1)}})]})]})]}),e.jsx(K,{className:"shadow"}),e.jsx("ul",{className:"faded-bottom no-scrollbar grid gap-4 overflow-auto pb-16 pt-4 md:grid-cols-2 lg:grid-cols-3",children:n.map(t=>e.jsxs("li",{className:"relative rounded-lg border p-4 hover:shadow-md",children:[!t.centerIsActive&&e.jsx("div",{className:"absolute bg-red-500 text-white px-3 rounded-e-md top-0 left-0",children:"Activate Center"}),e.jsxs("div",{className:"my-2 mt-3 flex items-center justify-between",children:[e.jsx("div",{className:"flex size-10 items-center justify-center rounded-lg bg-muted p-2 font-bold",children:t==null?void 0:t.centerAbbreviation}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{content:"Edit Center Details",trigger:e.jsx(se,{className:"cursor-pointer rounded-md border p-1 bg-slate-400 hover:bg-slate-600 transition-all fade-in-100 text-black hover:text-white",size:"25",onClick:()=>s(t.centerID,"Edit Center Details")})}),e.jsx(R,{content:t.centerIsActive?"InActivate Center":"Activate Center",trigger:t.centerIsActive?e.jsx(ne,{className:"cursor-pointer rounded-md border p-1 bg-slate-400 hover:bg-slate-600 transition-all fade-in-100 text-black hover:text-white",size:"25",onClick:()=>f(t.centerID,!t.centerIsActive)}):e.jsx(ae,{className:"cursor-pointer rounded-md border p-1 bg-slate-400 hover:bg-slate-600 transition-all fade-in-100 text-black hover:text-white",size:"25",onClick:()=>f(t.centerID,!t.centerIsActive)})}),e.jsx(R,{content:"Delete Center",trigger:e.jsx(Y,{className:"cursor-pointer rounded-md border p-1 bg-slate-400 hover:bg-slate-600 transition-all fade-in-100 text-black hover:text-white",size:"25",onClick:()=>m(t.centerID)})})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"mb-1 font-semibold text-xl",children:t.centerName}),e.jsxs("p",{className:"line-clamp-2 text-gray-900",children:["Phone: ",t.centerPhone]}),e.jsx("small",{className:"line-clamp-2 text-gray-500",children:t.centerAddress}),e.jsxs(T,{className:"my-2 flex gap-2",size:"sm",variant:"outline",onClick:()=>i(t.centerID),children:[e.jsx(oe,{size:15})," View Details"]})]})]},t.centerID))})]})]})}export{Ae as default};

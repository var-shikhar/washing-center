import{r,j as i,d as $,u as L,B as M}from"./index-UwPLBKTL.js";import{F as G,a as O,b as U,d as X,e as z}from"./form-DtQUbQgN.js";import{I as H}from"./input-C8Ga1pTM.js";import{S as q}from"./separator-BFtCrbz7.js";import{z as _,u as Z,t as J}from"./index-BsA6HpGF.js";const T=r.createContext(!1),V=r.forwardRef(({className:u,children:a,...R},C)=>{const{defaultValue:l,value:g,onChange:f,onComplete:p,onIncomplete:d,placeholder:P="â—‹",type:y="alphanumeric",name:m,form:b,otp:c=!1,mask:I=!1,disabled:j=!1,readOnly:N=!1,autoFocus:A=!1,ariaLabel:F="",...S}=R,B=Y(a),x=ee(a),{pins:t,pinValue:e,refMap:s,...n}=W({value:g,defaultValue:l,placeholder:P,type:y,length:x,readOnly:N});r.useEffect(()=>{f&&f(e)},[f,e]);const o=r.useRef(e.length===x);r.useEffect(()=>{e.length===x&&o.current===!1&&(o.current=!0,p&&p(e)),e.length!==x&&o.current===!0&&(o.current=!1,d&&d(e))},[x,p,d,e,t,g]),r.useEffect(()=>{if(!A)return;const w=s==null?void 0:s.get(0);w&&w.focus()},[A,s]);const v=r.useRef(0);let D=0;const k=B.map(w=>{if(w.type===K){const E=D;return D=D+1,r.cloneElement(w,{name:m,inputKey:`input-${E}`,value:x>E?t[E]:"",onChange:h=>n.handleChange(h,E),onFocus:h=>n.handleFocus(h,E),onBlur:()=>n.handleBlur(E),onKeyDown:h=>n.handleKeyDown(h,E),onPaste:h=>n.handlePaste(h),placeholder:P,type:y,mask:I,autoComplete:c?"one-time-code":"off",disabled:j,readOnly:N,"aria-label":F||`Pin input ${D} of ${x}`,ref:h=>{h?s==null||s.set(E,h):s==null||s.delete(E)}})}return v.current=v.current+1,w});return i.jsx(T.Provider,{value:!0,children:i.jsxs("div",{ref:C,"aria-label":"Pin Input",className:u,...S,children:[k,i.jsx("input",{type:"hidden",name:m,form:b,value:e})]})})});V.displayName="PinInput";const Q=({className:u,component:a,...R},C)=>{const{mask:l,type:g,inputKey:f,...p}=R;if(!r.useContext(T))throw new Error(`PinInputField must be used within ${V.displayName}.`);const P=a||"input";return i.jsx(P,{ref:C,type:l?"password":g==="numeric"?"tel":"text",inputMode:g==="numeric"?"numeric":"text",className:$("size-10 text-center",u),...p},f)},K=r.forwardRef(Q),W=({value:u,defaultValue:a,placeholder:R,type:C,length:l,readOnly:g})=>{const f=r.useMemo(()=>Array.from({length:l},(t,e)=>a?a.charAt(e):u?u.charAt(e):""),[a,l,u]),[p,d]=r.useState(f),P=p.join("").trim();r.useEffect(()=>{d(f)},[f]);const y=r.useRef(null);function m(){return y.current||(y.current=new Map),y.current}function b(t){const e=m();return e==null?void 0:e.get(t)}function c(t){const e=b(t);e&&(e.focus(),e.placeholder="")}function I(t,e){t.target.select(),c(e)}function j(t){const e=b(t);e&&(e.placeholder=R)}function N(t,e){const s=b(e);s&&(s.value=t),d(n=>n.map((o,v)=>v===e?t:o))}function A(t){return(C==="alphanumeric"?/^[a-zA-Z0-9]+$/i:/^[0-9]+$/).test(t)}const F=r.useRef(null);function S(t,e){const s=t.target.value,n=F.current,o=n&&n.length===l?n.charAt(l-1):s.slice(-1);A(o)&&(N(o,e),F.current=null,s.length>0&&c(e+1))}function B(t){t.preventDefault();const e=t.clipboardData.getData("text/plain").replace(/[\n\r\s]+/g,""),s=e.split("").slice(0,l);if(s.every(o=>A(o))){for(let o=0;o<l;o++)o<s.length&&N(s[o],o);F.current=e,c(s.length<l?s.length:l-1)}}function x(t,e){const{ctrlKey:s,key:n,shiftKey:o,metaKey:v}=t;C==="numeric"&&(!(n==="Backspace"||n==="Tab"||n==="Control"||n==="Delete"||s&&n==="v"||v&&n==="v"||!Number.isNaN(Number(n)))||g)&&t.preventDefault(),n==="ArrowLeft"||o&&n==="Tab"?(t.preventDefault(),c(e-1)):n==="ArrowRight"||n==="Tab"||n===" "?(t.preventDefault(),c(e+1)):n==="Delete"?t.preventDefault():n==="Backspace"&&(t.preventDefault(),N("",e),t.target.value===""&&c(e-1))}return{pins:p,pinValue:P,refMap:m(),handleFocus:I,handleBlur:j,handleChange:S,handlePaste:B,handleKeyDown:x}},Y=u=>r.Children.toArray(u).filter(a=>{if(r.isValidElement(a))return r.isValidElement(a);throw new Error(`${V.displayName} contains invalid children.`)}),ee=u=>r.Children.toArray(u).filter(a=>{if(r.isValidElement(a)&&a.type===K)return r.isValidElement(a)}).length,te=_.object({otp:_.string().min(1,{message:"Please enter your otp code."})});function ie({className:u,submissionURL:a,submissionType:R="put",successMessage:C="OTP has verified successfully!",successFn:l,...g}){const{HandlePostRequest:f}=L(),[p,d]=r.useState(!1),[P,y]=r.useState(!0),m=Z({resolver:J(te),defaultValues:{otp:""}});async function b(c){d(!0);const I=await f({data:c,route:a,type:R,toastDescription:C});d(!1),(I==null?void 0:I.status)===200&&l(I.data)}return i.jsx("div",{className:$("grid gap-6",u),...g,children:i.jsx(G,{...m,children:i.jsx("form",{onSubmit:m.handleSubmit(b),children:i.jsxs("div",{className:"grid gap-2",children:[i.jsx(O,{control:m.control,name:"otp",render:({field:c})=>i.jsxs(U,{className:"space-y-1",children:[i.jsx(X,{children:i.jsx(V,{...c,className:"flex h-10 justify-between",onComplete:()=>y(!1),onIncomplete:()=>y(!0),children:Array.from({length:7},(I,j)=>j===3?i.jsx(q,{orientation:"vertical"},j):i.jsx(K,{component:H,className:`${m.getFieldState("otp").invalid?"border-red-500":""}`},j))})}),i.jsx(z,{})]})}),i.jsx(M,{className:"mt-2",disabled:P,loading:p,children:"Verify"})]})})})})}export{ie as O};
